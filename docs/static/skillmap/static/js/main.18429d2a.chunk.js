(this.webpackJsonpskillsmap=this.webpackJsonpskillsmap||[]).push([[0],{39:function(e,t,a){},40:function(e,t,a){},41:function(e,t,a){},42:function(e,t,a){},43:function(e,t,a){},44:function(e,t,a){},45:function(e,t,a){},46:function(e,t,a){"use strict";a.r(t);var r=a(0),i=a(2),n=a.n(i),c=a(13),s=a.n(c),o=a(9),l=a(14),d=a(11),u=a(1),p="ADD_SKILL_MAP",h="CLEAR_SKILL_MAPS",v="CHANGE_SELECTED_ITEM",m="SET_SKILL_MAP_COMPLETED",f="SET_HEADERID_FOR_ACTIVITY",b="OPEN_ACTIVITY",j="CLOSE_ACTIVITY",y="SAVE_AND_CLOSE_ACTIVITY",g="RESTART_ACTIVITY",O="SET_USER",x="UPDATE_USER_COMPLETED_TAGS",k="SET_PAGE_TITLE",I="SET_PAGE_DESCRIPTION",w="SET_PAGE_INFO_URL",S="SET_PAGE_SOURCE_URL",C="SHOW_COMPLETION_MODAL",A="SHOW_RESTART_ACTIVITY_MODAL",N="SHOW_REPORT_ABUSE_MODAL",T="HIDE_MODAL",E=a(3),M=a.n(E),U=a(4),R="https://www.makecode.com/api/md";function L(e){var t={cmd:"",arg:""},a=/^(\w+)(:([:./\-+=\w]+))?/.exec((e||window.location.hash).replace(/^#/,""));return a&&(t={cmd:a[1],arg:a[3]||""}),t}function P(){var e={},t=window.location.search;t&&new URLSearchParams(t).forEach((function(t,a){"true"!==t.toLowerCase()&&"1"!==t||(t="true"),e[a]=t}));return e}function _(e,t){return D.apply(this,arguments)}function D(){return(D=Object(U.a)(M.a.mark((function e(t,a){var r,i,n,c,s;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&a){e.next=2;break}return e.abrupt("return",void 0);case 2:n="unknown",e.t0=t,e.next="docs"===e.t0?6:"github"===e.t0?11:14;break;case 6:return a=a.trim().replace(/^[\\/]/i,"").replace(/\.md$/i,""),c=(null===(r=window.pxtTargetBundle)||void 0===r?void 0:r.name)||"arcade",i="".concat(R,"/").concat(c,"/").concat(a),n="approved",e.abrupt("break",16);case 11:return e.next=13,H(a);case 13:return e.abrupt("return",e.sent);case 14:return i=a,e.abrupt("break",16);case 16:return e.next=18,W(i);case 18:return s=e.sent,e.abrupt("return",{text:s,identifier:i,status:n});case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e){return V.apply(this,arguments)}function V(){return(V=Object(U.a)(M.a.mark((function e(t){var a,r,i,n,c,s,o,l;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=pxt.github.parseRepoId(t),e.next=3,pxt.packagesConfigAsync();case 3:r=e.sent,i=pxt.github.repoStatus(a,r),n="unknown",e.t0=i,e.next=e.t0===pxt.github.GitRepoStatus.Banned?9:e.t0===pxt.github.GitRepoStatus.Approved?12:15;break;case 9:return n="banned",c="https://github.com/"+a.fullName,e.abrupt("break",17);case 12:return n="approved",c=void 0,e.abrupt("break",17);case 15:return c="https://github.com/"+a.fullName,e.abrupt("break",17);case 17:if(e.t1=a.tag,e.t1){e.next=22;break}return e.next=21,pxt.github.latestVersionAsync(a.fullName,r,!0);case 21:e.t1=e.sent;case 22:if(s=e.t1){e.next=26;break}return pxt.log("skillmap github tag not found at ".concat(a.fullName)),e.abrupt("return",void 0);case 26:return a.tag=s,e.next=29,pxt.github.downloadPackageAsync("".concat(a.fullName,"#").concat(a.tag),r);case 29:if(!(o=e.sent)){e.next=36;break}return l=(l=(l=(l=a.fileName||"skillmap").replace(/^\/?blob\/main\//,"")).replace(/^\/?blob\/master\//,"")).replace(/\.md$/,""),e.abrupt("return",{text:pxt.tutorial.resolveLocalizedMarkdown(a,o.files,l),identifier:a.fullName+"#"+l,reportId:c,status:n});case 36:return e.abrupt("return",void 0);case 37:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(){return(q=Object(U.a)(M.a.mark((function e(t,a){return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=3;break}return e.next=3,B("/api/".concat(encodeURIComponent(t),"/abusereports"),a);case 3:return e.abrupt("return");case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(e){return new Promise((function(t,a){var r=new XMLHttpRequest;r.addEventListener("error",(function(e){a(e)})),r.addEventListener("load",(function(){try{t(r.responseText)}catch(e){a(e)}})),r.open("GET",e),r.send()}))}function B(e,t){return new Promise((function(a,r){var i=new XMLHttpRequest;i.addEventListener("error",(function(e){r(e)})),i.addEventListener("load",(function(){try{a(i.responseText)}catch(e){r(e)}})),i.open("POST",e,!0),i.setRequestHeader("Content-type","application/json"),i.send(JSON.stringify(t))}))}function F(){var e=new Uint8Array(4);return function(e){if(window.crypto)window.crypto.getRandomValues(e);else for(var t=0;t<e.length;++t)e[t]=Math.floor(255*Math.random())}(e),new Uint32Array(e.buffer)[0]}function G(){function e(){return(65536|F()).toString(16).slice(-4)}return e()+e()+"-"+e()+"-4"+e().slice(-3)+"-"+e()+"-"+e()+e()+e()}function z(){return"localhost"===window.location.hostname}function Y(e){return"".concat(z()?"":"/static/skillmap","/").concat(e.replace(/^\//,""))}function K(e,t){var a,r;null===(a=(r=window).pxtTickEvent)||void 0===a||a.call(r,e,t)}var Q=a(10);function J(e,t,a){return!Object.keys(null===t||void 0===t?void 0:t.activities).some((function(r){var i,n;return!(null===e||void 0===e||null===(i=e.mapProgress[t.mapId])||void 0===i||null===(n=i.activityState[r])||void 0===n?void 0:n.isCompleted)&&r!==a}))}function $(e,t,a){var r;return!!(null===(r=ee(e,t,a))||void 0===r?void 0:r.isCompleted)}function X(e,t,a){var r,i=Object(Q.a)(t.prerequisites);try{for(i.s();!(r=i.n()).done;){var n=r.value;if("tag"===n.type){if(!e.completedTags[a])return!1;var c=e.completedTags[a][n.tag];if(void 0===c||c<n.numberCompleted)return!1}else if("map"===n.type&&!J(e,t))return!1}}catch(s){i.e(s)}finally{i.f()}return!0}function Z(e,t){var a,r={},i=Object(Q.a)(t);try{for(i.s();!(a=i.n()).done;)for(var n=a.value,c=0,s=Object.keys(n.activities);c<s.length;c++){var o=s[c],l=n.activities[o];if($(e,n.mapId,l.activityId)){var d,u=Object(Q.a)(l.tags);try{for(u.s();!(d=u.n()).done;){var p=d.value;r[p]||(r[p]=0),r[p]++}}catch(h){u.e(h)}finally{u.f()}}}}catch(h){i.e(h)}finally{i.f()}return r}function ee(e,t,a){var r;return null===(r=e.mapProgress[t])||void 0===r?void 0:r.activityState[a]}var te={title:lf("Game Maker Guide"),description:lf("Level up your game making skills by completing the tutorials in this guide."),pageSourceStatus:"unknown",user:{isDebug:!0,id:G(),mapProgress:{},completedTags:{}},maps:{}};function ae(e,t,a,r,i,n){var c,s,o,l=t.mapId,p=ee(e,l,a);p||(p={isCompleted:!1,activityId:a,currentStep:i,maxSteps:n,headerId:r});var h=J(e,t,a)&&!p.isCompleted,v=p.isCompleted||void 0!==i&&void 0!==n&&i>=n;return Object(u.a)(Object(u.a)({},e),{},{mapProgress:Object(u.a)(Object(u.a)({},e.mapProgress),{},Object(d.a)({},l,Object(u.a)(Object(u.a)({},e.mapProgress[l]||{mapId:l}),{},{activityState:Object(u.a)(Object(u.a)({},(null===(c=e.mapProgress[l])||void 0===c?void 0:c.activityState)||{}),{},Object(d.a)({},a,Object(u.a)(Object(u.a)({},p),{},{headerId:r,currentStep:i,maxSteps:n,isCompleted:v}))),completionState:h?"transitioning":null===(s=e.mapProgress)||void 0===s||null===(o=s[l])||void 0===o?void 0:o.completionState})))})}function re(e,t,a){var r,i,n,c=t.mapId,s=ee(e,c,a);s||(s={isCompleted:!1,activityId:a,headerId:"",currentStep:0});var o=J(e,t,a)&&!s.isCompleted;return Object(u.a)(Object(u.a)({},e),{},{mapProgress:Object(u.a)(Object(u.a)({},e.mapProgress),{},Object(d.a)({},c,Object(u.a)(Object(u.a)({},e.mapProgress[c]||{mapId:c}),{},{activityState:Object(u.a)(Object(u.a)({},(null===(r=e.mapProgress[c])||void 0===r?void 0:r.activityState)||{}),{},Object(d.a)({},a,Object(u.a)(Object(u.a)({},s),{},{isCompleted:!0}))),completionState:o?"transitioning":null===(i=e.mapProgress)||void 0===i||null===(n=i[c])||void 0===n?void 0:n.completionState})))})}var ie,ne,ce=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:te,a=arguments.length>1?arguments[1]:void 0;switch(a.type){case p:return Object(u.a)(Object(u.a)({},t),{},{user:Object(u.a)(Object(u.a)({},t.user),{},{mapProgress:Object(u.a)(Object(u.a)({},t.user.mapProgress),{},Object(d.a)({},a.map.mapId,{completionState:"incomplete",mapId:a.map.mapId,activityState:{}}))}),maps:Object(u.a)(Object(u.a)({},t.maps),{},Object(d.a)({},a.map.mapId,a.map))});case h:return Object(u.a)(Object(u.a)({},t),{},{maps:{}});case v:return Object(u.a)(Object(u.a)({},t),{},{selectedItem:a.id});case m:return Object(u.a)(Object(u.a)({},t),{},{user:Object(u.a)(Object(u.a)({},t.user),{},{mapProgress:Object(u.a)(Object(u.a)({},t.user.mapProgress),{},Object(d.a)({},a.mapId,Object(u.a)(Object(u.a)({},t.user.mapProgress[a.mapId]),{},{completionState:"completed"})))})});case b:return Object(u.a)(Object(u.a)({},t),{},{editorView:{currentMapId:a.mapId,currentActivityId:a.activityId,state:"active",currentHeaderId:null===(e=ee(t.user,a.mapId,a.activityId))||void 0===e?void 0:e.headerId}});case y:return Object(u.a)(Object(u.a)({},t),{},{editorView:Object(u.a)(Object(u.a)({},t.editorView),{},{state:"saving"})});case j:return Object(u.a)(Object(u.a)({},t),{},{editorView:void 0,user:a.finished?re(t.user,t.maps[t.editorView.currentMapId],t.editorView.currentActivityId):t.user});case g:return Object(u.a)(Object(u.a)({},t),{},{modal:void 0,editorView:{state:"active",currentMapId:a.mapId,currentActivityId:a.activityId},user:ae(t.user,t.maps[a.mapId],a.activityId)});case f:return t.editorView?Object(u.a)(Object(u.a)({},t),{},{editorView:Object(u.a)(Object(u.a)({},t.editorView),{},{currentHeaderId:a.id}),user:ae(t.user,t.maps[t.editorView.currentMapId],t.editorView.currentActivityId,a.id,a.currentStep,a.maxSteps)}):t;case O:return Object(u.a)(Object(u.a)({},t),{},{user:a.user});case x:return t.pageSourceUrl?Object(u.a)(Object(u.a)({},t),{},{user:Object(u.a)(Object(u.a)({},t.user),{},{completedTags:Object(u.a)(Object(u.a)({},t.user.completedTags),{},Object(d.a)({},t.pageSourceUrl,Z(t.user,Object.keys(t.maps).map((function(e){return t.maps[e]})))))})}):t;case k:return Object(u.a)(Object(u.a)({},t),{},{title:a.title});case I:return Object(u.a)(Object(u.a)({},t),{},{description:a.description});case w:return Object(u.a)(Object(u.a)({},t),{},{infoUrl:a.infoUrl});case S:return Object(u.a)(Object(u.a)({},t),{},{pageSourceUrl:a.url,pageSourceStatus:a.status});case C:return Object(u.a)(Object(u.a)({},t),{},{modal:{type:"completion",currentMapId:a.mapId,currentActivityId:a.activityId}});case A:return Object(u.a)(Object(u.a)({},t),{},{modal:{type:"restart-warning",currentMapId:a.mapId,currentActivityId:a.activityId}});case N:return Object(u.a)(Object(u.a)({},t),{},{modal:{type:"report-abuse",currentMapId:a.mapId,currentActivityId:a.activityId}});case T:return Object(u.a)(Object(u.a)({},t),{},{modal:void 0});default:return t}},se=Object(l.b)(ce),oe=a(5),le=a(6),de=a(8),ue=a(7),pe=a(22),he=function(e,t){return{type:b,mapId:e,activityId:t}},ve=function(){return{type:y}},me=function(){return{type:T}},fe=a(23);a(39);function be(e){var t=e.icon,a=e.items,n=e.className,c=Object(i.useState)(!1),s=Object(fe.a)(c,2),o=s[0],l=s[1];return Object(r.jsxs)("div",{className:"dropdown ".concat(n," ").concat(o?"expanded":""),tabIndex:0,onClick:function(){return l(!o)},onBlur:function(){return l(!1)},children:[Object(r.jsx)("i",{className:"icon ".concat(t)}),o&&Object(r.jsx)("div",{className:"dropdown-menu",children:a.map((function(e,t){return Object(r.jsx)("div",{className:"dropdown-item",onClick:function(){return e.onClick(e.id)},children:e.label},t)}))})]})}function je(){return ne||(ie=new pxt.skillmap.IndexedDBWorkspace,ne=ie.initAsync().then((function(e){return ie}))),ne}function ye(e){return ge.apply(this,arguments)}function ge(){return(ge=Object(U.a)(M.a.mark((function e(t){var a;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,je();case 2:return a=e.sent,e.abrupt("return",a.getProjectAsync(t));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Oe(e){return xe.apply(this,arguments)}function xe(){return(xe=Object(U.a)(M.a.mark((function e(t){var a;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,je();case 2:return a=e.sent,e.next=5,a.saveProjectAsync(t);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ke(){return Ie.apply(this,arguments)}function Ie(){return(Ie=Object(U.a)(M.a.mark((function e(){var t;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,je();case 2:return t=e.sent,e.abrupt("return",t.getUserStateAsync());case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function we(e){return Se.apply(this,arguments)}function Se(){return(Se=Object(U.a)(M.a.mark((function e(t){var a;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.isDebug){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,je();case 4:return a=e.sent,e.next=7,a.saveUserStateAsync(t);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}a(40);var Ce=z()?"http://localhost:3232/index.html":window.pxtTargetBundle.appTheme.embedUrl,Ae=function(e){Object(de.a)(a,e);var t=Object(ue.a)(a);function a(e){var r;return Object(oe.a)(this,a),(r=t.call(this,e)).ref=void 0,r.messageQueue=[],r.finishedActivityState=void 0,r.nextId=0,r.pendingMessages={},r.handleFrameRef=function(e){e&&e.contentWindow&&(window.addEventListener("message",r.onMessageReceived),r.ref=e,r.ref.addEventListener("load",(function(){r.state.unloading&&(r.props.dispatchCloseActivity("finished"===r.finishedActivityState),r.props.dispatchUpdateUserCompletedTags(),r.finishedActivityState=void 0)})),Ne(".usabilla_live_button_container",!1),Ne("footer",!1))},r.onMessageReceived=function(e){var t=e.data;if("ready"!==t.type){if("pxteditor"===t.type&&t.id&&r.pendingMessages[t.id])return r.onResponseReceived(r.pendingMessages[t.id],e.data),void delete r.pendingMessages[t.id];switch(t.action){case"event":r.handleEditorTickEvent(t);break;case"workspacesync":r.handleWorkspaceSyncRequest(t);break;case"workspacesave":r.handleWorkspaceSaveRequestAsync(t)}}else r.handleWorkspaceReadyEventAsync()},r.state={loaded:!1,unloading:!1},r}return Object(le.a)(a,[{key:"componentDidUpdate",value:function(){this.props.save&&this.sendMessage({type:"pxteditor",action:"saveproject",response:!1},!0)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("message",this.onMessageReceived),Ne(".usabilla_live_button_container",!0),Ne("footer",!0)}},{key:"render",value:function(){var e=this.props,t=e.url,a=e.title,i=e.save,n=this.state,c=n.loaded,s=n.unloading,o=i?lf("Saving..."):lf("Loading...");return Object(r.jsxs)("div",{className:"makecode-frame-outer",children:[Object(r.jsxs)("div",{className:"makecode-frame-loader ".concat(c&&!i?"hidden":""),children:[Object(r.jsx)("img",{src:Y("assets/logo.svg"),alt:"MakeCode Logo"}),Object(r.jsx)("div",{className:"makecode-frame-loader-text",children:o})]}),Object(r.jsx)("iframe",{className:"makecode-frame",src:s?"about:blank":t,title:a,ref:this.handleFrameRef})]})}},{key:"onResponseReceived",value:function(e,t){var a=this.props.save;"saveproject"===e.action&&a&&("saving"===this.finishedActivityState?(this.finishedActivityState="finished",this.sendMessage({type:"pxteditor",action:"saveproject"},!0)):this.setState({unloading:!0})),"importproject"===e.action&&this.onEditorLoaded()}},{key:"sendMessage",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=function(e){a&&(e.response=!0,e.id=t.nextId+++"",t.pendingMessages[e.id]=e),t.ref.contentWindow.postMessage(e,"*")};if(this.ref)if(this.ref.contentWindow){for(;this.messageQueue.length;)r(this.messageQueue.shift());r(e)}else this.messageQueue.push(e)}},{key:"handleWorkspaceSyncRequest",value:function(e){this.sendMessage(Object(u.a)(Object(u.a)({},e),{},{success:!0,projects:[]}))}},{key:"handleWorkspaceSaveRequestAsync",value:function(){var e=Object(U.a)(M.a.mark((function e(t){var a,r,i,n,c,s,o,l,d,p,h;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.props,i=r.dispatchSetHeaderIdForActivity,n=r.activityHeaderId,c=r.activityType,s=r.title,o=Object(u.a)(Object(u.a)({},t.project),{},{header:Object(u.a)(Object(u.a)({},t.project.header),{},{id:n||t.project.header.id})}),(null===(a=o.header)||void 0===a?void 0:a.name)!==s&&(o.header.name=s,(l=o.text["pxt.json"])&&((d=JSON.parse(l)).name=s,o.text["pxt.json"]=pxt.Package.stringifyConfig(d))),!o.header.tutorialCompleted){e.next=8;break}return e.next=6,ye(o.header.id);case 6:(null===(h=e.sent)||void 0===h||null===(p=h.header)||void 0===p?void 0:p.tutorial)&&(o.header.tutorial=h.header.tutorial,o.header.tutorial.tutorialStep=o.header.tutorialCompleted.steps-1,delete o.header.tutorialCompleted);case 8:if("tutorial"===c&&!o.header.tutorial&&!o.header.tutorialCompleted){e.next=11;break}return e.next=11,Oe(o);case 11:o.header.tutorial?i(o.header.id,(o.header.tutorial.tutorialStep||0)+1,o.header.tutorial.tutorialStepInfo.length):o.header.tutorialCompleted&&i(o.header.id,o.header.tutorialCompleted.steps,o.header.tutorialCompleted.steps);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleWorkspaceReadyEventAsync",value:function(){var e=Object(U.a)(M.a.mark((function e(){var t;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.props.activityHeaderId){e.next=7;break}return e.next=3,ye(this.props.activityHeaderId);case 3:t=e.sent,this.sendMessage({type:"pxteditor",action:"importproject",project:t},!0),e.next=8;break;case 7:this.sendMessage({type:"pxteditor",action:"startactivity",path:this.props.tutorialPath,activityType:"tutorial"},!0);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleEditorTickEvent",value:function(e){switch(e.tick){case"tutorial.editorLoaded":this.onEditorLoaded();break;case"tutorial.complete":this.onTutorialFinished()}}},{key:"onEditorLoaded",value:function(){K("skillmap.activity.loaded"),this.setState({loaded:!0})}},{key:"onTutorialFinished",value:function(){K("skillmap.activity.complete"),this.finishedActivityState="saving",this.props.dispatchSaveAndCloseActivity()}}]),a}(i.Component);function Ne(e,t){var a=document.querySelector(e);(null===a||void 0===a?void 0:a.style)&&(a.style.display=t?"":"none")}var Te={dispatchSetHeaderIdForActivity:function(e,t,a){return{type:f,id:e,currentStep:t,maxSteps:a}},dispatchCloseActivity:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return{type:j,finished:e}},dispatchSaveAndCloseActivity:ve,dispatchUpdateUserCompletedTags:function(){return{type:x}}},Ee=Object(o.b)((function(e,t){var a;if(!e||!e.editorView)return{};var r,i=e.editorView,n=i.currentActivityId,c=i.currentMapId,s=i.currentHeaderId,o=i.state,l=Ce,d=e.maps[c].activities[n];return"/"!==Ce.charAt(Ce.length-1)||z()||(l=Ce.substr(0,Ce.length-1)),l+="?controller=1&skillsMap=1&noproject=1&nocookiebanner=1",r=d.displayName,{url:l,tutorialPath:d.url,title:r,activityId:n,activityHeaderId:s,completed:null===(a=ee(e.user,c,n))||void 0===a?void 0:a.isCompleted,activityType:d.type,save:"saving"===o}}),Te)(Ae),Me=function(e){Object(de.a)(a,e);var t=Object(ue.a)(a);function a(){var e;Object(oe.a)(this,a);for(var r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];return(e=t.call.apply(t,[this].concat(i))).reportAbuseUrl="https://github.com/contact/report-content",e.onBackClicked=function(){K("skillmap.activity.back"),e.props.dispatchSaveAndCloseActivity()},e.onSaveClicked=function(){var t=e.props.completedHeaderId;window.open("".concat(Ce,"#skillmapimport:").concat(t))},e}return Object(le.a)(a,[{key:"getSettingItems",value:function(){var e=this,t=[];return this.props.showReportAbuse&&t.push({id:"report",label:"Report Abuse",onClick:function(t){return window.open(e.reportAbuseUrl)}}),t}},{key:"render",value:function(){var e=this.props,t=e.activityOpen,a=e.completedHeaderId,i=this.getSettingItems();return Object(r.jsxs)("div",{className:"header",children:[Object(r.jsx)("div",{className:"header-left",children:t?Object(r.jsx)("i",{className:"icon arrow left",role:"button",onClick:this.onBackClicked}):Object(r.jsx)("div",{className:"header-logo",children:Object(r.jsx)("img",{src:Y("assets/logo.svg"),alt:"MakeCode Logo"})})}),Object(r.jsx)("div",{className:"spacer"}),Object(r.jsxs)("div",{className:"header-right",children:[a&&Object(r.jsx)("div",{className:"header-button",onClick:this.onSaveClicked,children:lf("SAVE TO MY PROJECTS")}),(null===i||void 0===i?void 0:i.length)>0&&Object(r.jsx)(be,{icon:"setting",className:"header-settings",items:i}),Object(r.jsx)("div",{className:"header-org-logo",children:Object(r.jsx)("img",{src:Y("assets/microsoft.png"),alt:"Microsoft Logo"})})]})]})}}]),a}(i.Component);var Ue={dispatchSaveAndCloseActivity:ve},Re=Object(o.b)((function(e,t){var a,r;return e?((null===(a=e.editorView)||void 0===a?void 0:a.currentHeaderId)&&$(e.user,e.editorView.currentMapId,e.editorView.currentActivityId)&&(r=e.editorView.currentHeaderId),{activityOpen:!!e.editorView,showReportAbuse:"unknown"===e.pageSourceStatus,completedHeaderId:r}):{}}),Ue)(Me),Le=function(e){Object(de.a)(a,e);var t=Object(ue.a)(a);function a(){return Object(oe.a)(this,a),t.apply(this,arguments)}return Object(le.a)(a,[{key:"render",value:function(){var e=this.props,t=e.title,a=e.description,i=e.icon;return Object(r.jsx)("div",{className:"banner",children:Object(r.jsxs)("div",{className:"banner-card",children:[Object(r.jsx)("i",{className:"icon ".concat(i)}),Object(r.jsxs)("div",{className:"banner-text",children:[Object(r.jsx)("div",{className:"banner-title",children:t}),Object(r.jsx)("div",{className:"banner-description",children:a})]})]})})}}]),a}(i.Component);var Pe=Object(o.b)((function(e,t){return{title:e.title,description:e.description}}))(Le),_e=(a(41),function(e){Object(de.a)(a,e);var t=Object(ue.a)(a);function a(){var e;Object(oe.a)(this,a);for(var r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];return(e=t.call.apply(t,[this].concat(i))).handleModalClick=function(e){e.stopPropagation(),e.preventDefault()},e.handleCloseClick=function(){e.props.onClose&&e.props.onClose(),e.setState({visible:!1})},e}return Object(le.a)(a,[{key:"render",value:function(){var e=this.props,t=e.title,a=e.actions;return Object(r.jsx)("div",{className:"modal-overlay",onClick:this.handleCloseClick,children:Object(r.jsxs)("div",{className:"modal",onClick:this.handleModalClick,children:[Object(r.jsxs)("div",{className:"modal-header",children:[Object(r.jsx)("div",{className:"modal-title",children:t}),Object(r.jsx)("div",{className:"spacer"}),Object(r.jsx)("div",{className:"modal-close-icon",onClick:this.handleCloseClick,children:Object(r.jsx)("i",{className:"icon close"})})]}),Object(r.jsx)("div",{className:"modal-body",children:this.props.children}),a&&a.length>0&&Object(r.jsx)("div",{className:"modal-actions",children:a.map((function(e,t){return Object(r.jsx)("div",{className:"modal-button ".concat(e.className),onClick:e.onClick,children:e.label},t)}))})]})})}}]),a}(i.Component)),De=function(e){Object(de.a)(a,e);var t=Object(ue.a)(a);function a(){return Object(oe.a)(this,a),t.apply(this,arguments)}return Object(le.a)(a,[{key:"render",value:function(){var e=this.props,t=e.activity,a=e.type,i=e.completionType;switch(a){case"completion":return t||"map"===i?this.renderCompletionModal():Object(r.jsx)("div",{});case"restart-warning":return t?this.renderRestartWarning():Object(r.jsx)("div",{});case"report-abuse":return this.renderReportAbuse();default:return Object(r.jsx)("div",{})}}},{key:"renderCompletionModal",value:function(){var e=this.props,t=e.type,a=e.displayName,i=e.dispatchHideModal,n=e.completionType,c=e.actions;if(!t)return Object(r.jsx)("div",{});var s="activity"===n?lf("Activity Complete!"):lf("Path Complete!"),o=lf("Good work! You've completed {0}. Collect your certificate and keep going!","{0}").split("{0}");return Object(r.jsxs)("div",{className:"confetti-container",children:[Object(r.jsxs)(_e,{title:s,actions:c,onClose:function(){return i()},children:[o[0],Object(r.jsx)("strong",{children:a}),o[1]]}),Array(100).fill(0).map((function(e,t){var a={animationDelay:"".concat(t%100*.1,"s"),left:"".concat(1*Math.floor(100*Math.random()),"%")};return Object(r.jsx)("div",{style:a,className:"confetti ".concat(Math.random()>.5?"reverse":""," color-").concat(Math.floor(9*Math.random()))},t)}))]})}},{key:"renderRestartWarning",value:function(){var e=this.props,t=e.mapId,a=e.activity,i=e.dispatchHideModal,n=e.dispatchRestartActivity,c=lf("Restart Activity?"),s=lf("Are you sure you want to restart {0}? You won't lose your path progress but the code have written for this activity will be deleted.","{0}").split("{0}"),o=[{label:lf("CANCEL"),onClick:function(){return i()}},{label:lf("RESTART"),onClick:function(){K("skillmap.activity.restart",{map:t,activity:a.activityId}),n(t,a.activityId)}}];return Object(r.jsxs)(_e,{title:c,actions:o,onClose:function(){return i()},children:[s[0],Object(r.jsx)("strong",{children:a.displayName}),s[1]]})}},{key:"renderReportAbuse",value:function(){var e=this.props,t=e.pageSourceUrl,a=e.dispatchHideModal,i=[{label:"REPORT",onClick:function(){K("skillmap.reportabuse",{path:t||""}),function(e,t){q.apply(this,arguments)}(t||"",{text:document.querySelector(".report-abuse-text").value}),a()}}];return Object(r.jsx)(_e,{title:"Report Abuse",actions:i,onClose:function(){return a()},children:Object(r.jsx)("textarea",{className:"report-abuse-text",placeholder:"Describe the content and explain why you are reporting it for abuse. Provide as much detail as possible!"})})}}]),a}(i.Component);var He={dispatchHideModal:me,dispatchRestartActivity:function(e,t){return{type:g,mapId:e,activityId:t}},dispatchOpenActivity:he},Ve=Object(o.b)((function(e,t){if(!e)return{};var a,r,i,n=e.pageSourceUrl,c=e.modal||{},s=c.currentMapId,o=c.currentActivityId,l=c.type,d=[];if(s&&"restart-warning"!==l){var u=e.maps[s];if(o){var p,h,v=u.activities[o];i="activity",r=v.displayName,a=null===(p=v.next)||void 0===p||null===(h=p[0])||void 0===h?void 0:h.activityId,d.push({label:lf("NEXT"),onClick:function(){K("skillmap.activity.next",{map:s,activity:o}),me(),he(s,a||"")}})}else i="map",r=u.displayName,d.push({label:lf("CERTIFICATE"),onClick:function(){K("skillmap.certificate",{map:s}),window.open(u.completionUrl)}})}return{type:l,completionType:i,displayName:r,nextActivityId:a,pageSourceUrl:n,actions:d,mapId:s,activity:s&&o?e.maps[s].activities[o]:void 0}}),He)(De);function qe(e){var t=e.label;return Object(r.jsx)("span",{children:t})}function We(e){var t=e.item,a=e.itemTemplate,i=e.selected,n=e.className,c=e.onSelect,s=a||qe;return Object(r.jsx)("div",{className:"carousel-item ".concat(i?"selected":""," ").concat(n||""),onClick:function(){c&&c(t.id)},children:Object(r.jsx)(s,Object(u.a)({},t))})}a(42);var Be=function(e){Object(de.a)(a,e);var t=Object(ue.a)(a);function a(e){var r;return Object(oe.a)(this,a),(r=t.call(this,e)).scrollMargin=5,r.carouselRef=void 0,r.scrollTo=function(e){r.carouselRef.scrollTo(e,0)},r.handleLeftArrowClick=function(){r.carouselRef.scrollBy({left:-window.innerWidth/2})},r.handleRightArrowClick=function(){r.carouselRef.scrollBy({left:window.innerWidth/2})},r.handleScroll=function(){var e=r.carouselRef.scrollLeft;r.setState({showLeft:e>r.scrollMargin,showRight:r.carouselRef.scrollWidth-r.carouselRef.clientWidth-e>r.scrollMargin})},r.state={showLeft:!1,showRight:!0},r}return Object(le.a)(a,[{key:"componentDidMount",value:function(){this.handleScroll(),window.addEventListener("resize",this.handleScroll)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleScroll)}},{key:"render",value:function(){var e=this,t=this.props,a=t.title,i=t.items,n=t.selectedItem,c=t.itemTemplate,s=t.itemClassName,o=t.onItemSelect,l=t.prependChildren,d=t.appendChildren,u=t.titleIcon,p=t.titleDecoration,h=this.state,v=h.showLeft,m=h.showRight;return Object(r.jsxs)("div",{className:"carousel",children:[a&&Object(r.jsxs)("div",{className:"carousel-title",children:[u&&Object(r.jsx)("i",{className:"icon ".concat(u)}),Object(r.jsx)("span",{children:a}),p&&Object(r.jsx)("span",{className:"carousel-subtitle",children:p})]}),v&&Object(r.jsx)("div",{className:"carousel-arrow left",onClick:this.handleLeftArrowClick,children:Object(r.jsx)("i",{className:"icon chevron left"})}),Object(r.jsx)("div",{className:"carousel-items",children:Object(r.jsxs)("div",{className:"carousel-items-inner",onScroll:this.handleScroll,ref:function(t){return e.carouselRef=t},children:[l,i.map((function(e,t){return Object(r.jsx)(We,{className:s,item:e,itemTemplate:c,selected:n===e.id,onSelect:o},t)})),d]})}),m&&Object(r.jsx)("div",{className:"carousel-arrow right",onClick:this.handleRightArrowClick,children:Object(r.jsx)("i",{className:"icon chevron right"})})]})}}]),a}(i.Component),Fe=(a(43),function(e){Object(de.a)(a,e);var t=Object(ue.a)(a);function a(){var e;Object(oe.a)(this,a);for(var r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];return(e=t.call.apply(t,[this].concat(i))).handleActionButtonClick=function(){var t=e.props,a=t.status,r=t.mapId,i=t.id,n=t.dispatchOpenActivity;switch(a){case"locked":break;case"completed":case"inprogress":case"notstarted":default:return K("skillmap.activity.open",{map:r,activity:i,status:a||""}),n(r,i)}},e.handleRestartButtonClick=function(){var t=e.props,a=t.mapId,r=t.id;(0,t.dispatchShowRestartActivityWarning)(a,r)},e}return Object(le.a)(a,[{key:"getSkillCardActionText",value:function(){switch(this.props.status){case"locked":return lf("LOCKED");case"completed":return lf("VIEW CODE");case"inprogress":return lf("CONTINUE");case"notstarted":default:return lf("START")}}},{key:"render",value:function(){var e=this.props,t=e.label,a=e.description,i=e.imageUrl,n=e.tags,c=e.status,s=e.currentStep,o=e.maxSteps;return Object(r.jsx)("div",{className:"skill-card-container",children:Object(r.jsxs)("div",{className:"skill-card ".concat(c||""),children:[Object(r.jsxs)("div",{className:"skill-card-display",children:[Object(r.jsx)("div",{className:"skill-card-image",children:i?Object(r.jsx)("img",{src:i,alt:lf("Preview of activity content")}):Object(r.jsx)("i",{className:"icon ".concat("locked"!==c?"game":"")})}),Object(r.jsxs)("div",{className:"skill-card-label",children:[Object(r.jsxs)("div",{className:"skill-card-title",children:["completed"===c&&Object(r.jsx)("i",{className:"icon check circle"}),"inprogress"===c&&o&&Object(r.jsx)("span",{className:"circular-label",children:"".concat(s,"/").concat(o)}),Object(r.jsx)("span",{children:t})]}),Object(r.jsx)("div",{className:"skill-card-tags",children:null===n||void 0===n?void 0:n.map((function(e,t){return Object(r.jsx)("div",{children:e},t)}))})]}),"locked"===c&&Object(r.jsx)("div",{className:"skill-card-overlay",children:Object(r.jsx)("i",{className:"icon lock"})})]}),Object(r.jsxs)("div",{className:"skill-card-info",children:[Object(r.jsx)("div",{className:"skill-card-title",children:t}),Object(r.jsx)("div",{className:"skill-card-description",children:a}),Object(r.jsx)("div",{className:"spacer"}),Object(r.jsxs)("div",{className:"skill-card-action",children:["completed"===c&&Object(r.jsx)("div",{className:"skill-card-button-icon",role:"button",onClick:this.handleRestartButtonClick,children:Object(r.jsx)("i",{className:"xicon redo"})}),Object(r.jsx)("div",{className:"skill-card-button",role:"button",onClick:this.handleActionButtonClick,children:this.getSkillCardActionText()})]})]})]})})}}]),a}(i.Component));var Ge={dispatchOpenActivity:he,dispatchShowRestartActivityWarning:function(e,t){return{type:A,mapId:e,activityId:t}}},ze=Object(o.b)((function(e,t){var a,r,i,n=null===(a=e.maps)||void 0===a?void 0:a[t.mapId],c=e.user&&n&&function(e,t,a){return t.root.activityId===a||function r(i){if($(e,t.mapId,i.activityId)){if(i.next.some((function(e){return e.activityId===a})))return!0;var n,c=Object(Q.a)(i.next);try{for(c.s();!(n=c.n()).done;){if(r(n.value))return!0}}catch(s){c.e(s)}finally{c.f()}}return!1}(t.root)}(e.user,n,t.id)?"notstarted":"locked";if(e.user)if(n&&e.pageSourceUrl&&!X(e.user,n,e.pageSourceUrl))c="locked";else{var s=ee(e.user,t.mapId,t.id);s&&(s.isCompleted?c="completed":s.headerId&&(c="inprogress",r=null===s||void 0===s?void 0:s.currentStep,i=null===s||void 0===s?void 0:s.maxSteps))}return{status:c,currentStep:r,maxSteps:i}}),Ge)(Fe),Ye=function(e){Object(de.a)(a,e);var t=Object(ue.a)(a);function a(e){var r;return Object(oe.a)(this,a),(r=t.call(this,e)).carouselRef=void 0,r.items=void 0,r.onItemSelect=function(e){e!==r.props.selectedItem?(K("skillmap.carousel.item.select",{map:r.props.map.mapId,activity:e}),r.props.dispatchChangeSelectedItem(e)):(K("skillmap.carousel.item.deselect",{map:r.props.map.mapId,activity:e}),r.props.dispatchChangeSelectedItem(void 0))},r.handleEndCardClick=function(){K("skillmap.carousel.endcard.click",{map:r.props.map.mapId}),r.props.dispatchShowCompletionModal(r.props.map.mapId)},r.handleEndCardTransition=function(){K("skillmap.carousel.endcard.auto",{map:r.props.map.mapId}),r.props.dispatchShowCompletionModal(r.props.map.mapId)},r.items=r.getItems(e.map.mapId,e.map.root),r}return Object(le.a)(a,[{key:"getItems",value:function(e,t){for(var a=[],r=t;r;)a.push({id:r.activityId,mapId:e,label:r.displayName,description:r.description,tags:r.tags,url:r.url,imageUrl:r.imageUrl}),r=r.next[0];return a}},{key:"getEndCard",value:function(){return Object(r.jsx)("div",{className:"end-card ".concat("completed"===this.props.completionState?"spin":""),children:Object(r.jsx)("div",{className:"end-card-icon",onClick:this.handleEndCardClick,children:Object(r.jsx)("i",{className:"icon trophy",onTransitionEnd:this.handleEndCardTransition})})},"end")}},{key:"renderRequirements",value:function(){var e=this;if(this.props.pageSourceUrl){var t=this.props.map.prerequisites,a=this.props.user.completedTags,i=t.map((function(t){if("tag"===t.type){var i=t.numberCompleted;if(a[e.props.pageSourceUrl]&&a[e.props.pageSourceUrl][t.tag]&&(i=Math.max(i-a[e.props.pageSourceUrl][t.tag],0)),i)return Object(r.jsxs)("span",{children:[i," ",Object(r.jsx)("span",{className:"carousel-subtitle-tag",children:t.tag})]},"tag_"+t.tag)}return null})).filter((function(e){return!!e})),n=this.props.requiredMaps.map((function(e){return Object(r.jsx)("span",{className:"carousel-subtitle-map",children:e.displayName},"map_"+e.mapId)}));return i.length||n.length?n.length?i.length?Qe(lf("Complete {0} tutorial(s) and the {1} map(s) to unlock!","{0}","{1}"),[Ke(i),Ke(n)]):Qe(lf("Complete the {0} map(s) to unlock!","{0}"),[Ke(n)]):Qe(lf("Complete {0} tutorial(s) to unlock!","{0}"),[Ke(i)]):void 0}}},{key:"componentDidUpdate",value:function(e){"transitioning"===e.completionState&&(this.carouselRef.scrollTo(1e4),setTimeout((function(){return e.dispatchSetSkillMapCompleted(e.map.mapId)}),400))}},{key:"render",value:function(){var e=this,t=this.props,a=t.map,i=t.user,n=t.selectedItem,c=J(i,a)?[this.getEndCard()]:[],s=this.renderRequirements();return Object(r.jsx)(Be,{title:a.displayName,items:this.items,itemTemplate:ze,itemClassName:"linked",onItemSelect:this.onItemSelect,selectedItem:n,appendChildren:c,titleIcon:s&&"lock",titleDecoration:s,ref:function(t){return e.carouselRef=t}})}}]),a}(i.Component);function Ke(e){return e.length<=1?e[0]:2===e.length?Object(r.jsxs)("span",{children:[e[0]," and ",e[1]]}):Object(r.jsxs)("span",{children:[e.slice(0,e.length-1).map((function(e){return Object(r.jsxs)("span",{children:[e,", "]})}))," and ",e[e.length-1]]})}function Qe(e,t){for(var a=[],i=e,n=0,c=0;c<t.length;c++){var s=i.split("{"+c+"}");a.push(Object(r.jsx)("span",{children:s[0]},n++)),a.push(Object(r.jsx)("span",{children:t[c]},n++)),i=i.substr(s[0].length+3)}return a.push(Object(r.jsx)("span",{children:i},n++)),Object(r.jsx)("span",{children:a})}var Je={dispatchChangeSelectedItem:function(e){return{type:v,id:e}},dispatchShowCompletionModal:function(e,t){return{type:C,mapId:e,activityId:t}},dispatchSetSkillMapCompleted:function(e){return{type:m,mapId:e}}},$e=Object(o.b)((function(e,t){var a,r,i,n,c,s;if(!e)return{};var o=t.map,l=[];return(null===(a=o.prerequisites)||void 0===a?void 0:a.length)&&e.pageSourceUrl&&(l=o.prerequisites.filter((function(t){return"map"===t.type&&!X(e.user,e.maps[t.mapId],e.pageSourceUrl)})).map((function(t){return e.maps[t.mapId]}))),{user:e.user,requiredMaps:l,pageSourceUrl:e.pageSourceUrl,completionState:null===(r=e.user)||void 0===r||null===(i=r.mapProgress)||void 0===i||null===(n=i[o.mapId])||void 0===n?void 0:n.completionState,selectedItem:e.selectedItem&&(null===(c=t.map)||void 0===c||null===(s=c.activities)||void 0===s?void 0:s[e.selectedItem])?e.selectedItem:void 0}}),Je)(Ye);function Xe(e){for(var t,a,r=function(e){var t,a=e.split("\n"),r=[],i=null,n=null,c=null,s=Object(Q.a)(a);try{for(s.s();!(t=s.n()).done;){var o=t.value;if(o.trim()){if(o.startsWith("#")){var l=/^(#+)\s*(.+)$/.exec(o);if(l){u(),i={headerKind:1===l[1].length?"single":2===l[1].length?"double":"triple",header:l[2],attributes:{}},n=null,c=null;continue}}if(i){var d=/^[*-]\s+(?:([^:]+):)?(.*)$/.exec(o);d&&(d[1]?(n&&c&&(i.attributes[n]=c.trim()),n=d[1].toLowerCase(),c=d[2]):n&&(c+=d[2]))}}else c&&(c+="\n")}}catch(p){s.e(p)}finally{s.f()}return u(),r;function u(){i&&(n&&c&&(i.attributes[n]=c.trim()),r.push(i))}}(e),i=[],n=-1,c=0;c<r.length;c++)"single"===r[c].headerKind?t={title:(a=r[c]).attributes.name||a.header,description:a.attributes.description,infoUrl:a.attributes.infoUrl}:"double"===r[c].headerKind&&(n>=0&&i.push(Ze(r[n],r.slice(n+1,c))),n=c);return(n>0||0===i.length)&&i.push(Ze(r[n],r.slice(n+1,r.length))),{maps:i,metadata:t}}function Ze(e,t){var a=function(e){var t={mapId:e.header.toLowerCase(),displayName:e.attributes.name||e.header,description:e.attributes.description,completionUrl:e.attributes.completionurl,prerequisites:[],activities:{}};if(e.attributes.required){var a,r=e.attributes.required.split(","),i=Object(Q.a)(r);try{for(i.s();!(a=i.n()).done;){var n=a.value,c=/^\s*(?:(\d+) +)?(.+)$/.exec(n);c[1]?t.prerequisites.push({type:"tag",tag:c[2].trim(),numberCompleted:parseInt(c[1])}):t.prerequisites.push({type:"map",mapId:c[2].trim()})}}catch(s){i.e(s)}finally{i.f()}}return t}(e),r=t.map(et);a.root=r[0];var i,n=Object(Q.a)(r);try{for(n.s();!(i=n.n()).done;){var c=i.value;a.activities[c.activityId]&&at("Duplicate activity id '".concat(c.activityId,"' in map '").concat(a.mapId,"'")),a.activities[c.activityId]=c}}catch(j){n.e(j)}finally{n.f()}var s,o=Object(Q.a)(r);try{for(o.s();!(s=o.n()).done;){var l,d=s.value,p=Object(Q.a)(d.nextIds);try{for(p.s();!(l=p.n()).done;){var h=l.value;a.activities[h]||at("Unknown activity id '".concat(h,"' in map '").concat(a.mapId,"'")),d.next.push(a.activities[h])}}catch(j){p.e(j)}finally{p.f()}}}catch(j){o.e(j)}finally{o.f()}var v={};!function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r[t.activityId]&&at("Loop in map '".concat(a.mapId,"' detected"));r[t.activityId]=!0,v[t.activityId]=!0,t.next.length>1&&at("Branching currently not supported");var i,n=Object(Q.a)(t.next);try{for(n.s();!(i=n.n()).done;){var c=i.value;e(c,Object(u.a)({},r))}}catch(j){n.e(j)}finally{n.f()}}(a.root);var m,f=Object(Q.a)(r);try{for(f.s();!(m=f.n()).done;){var b=m.value;v[b.activityId]||console.warn("Unreachable activity detected '".concat(b.activityId,"' in map '").concat(a.mapId,"'"))}}catch(j){f.e(j)}finally{f.f()}return a}function et(e){var t={activityId:e.header.toLowerCase(),displayName:e.attributes.name||e.header,description:e.attributes.description,url:e.attributes.url,imageUrl:e.attributes.imageurl,tags:tt(e.attributes.tags),next:[],nextIds:tt(e.attributes.next)};if(e.attributes.type){var a=e.attributes.type.toLowerCase();switch(a){case"tutorial":t.type=a}}if(e.attributes.editor){var r=e.attributes.editor.toLowerCase();switch(r){case"py":case"blocks":case"js":t.editor=r;break;default:t.editor="blocks"}}return t.url||at("Activity '".concat(t.activityId,"' is missing attribute 'url'")),t.type||at("Activity '".concat(t.activityId,"' is missing attribute 'type'")),t}function tt(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return[];var a=e.split(",").map((function(e){return e.trim().toLowerCase()})).filter((function(e){return!!e}));if(!t){var r={};return a.forEach((function(e){return r[e]=e})),Object.keys(r)}return a}function at(e){throw e}a(44),a(45);window.Promise=pe;var rt=function(e){Object(de.a)(a,e);var t=Object(ue.a)(a);function a(e){var r;return Object(oe.a)(this,a),(r=t.call(this,e)).queryFlags={},r.unsubscribeChangeListener=void 0,r.loadedUser=void 0,r.handleHashChange=function(){var e=Object(U.a)(M.a.mark((function e(t){var a,i,n;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pxt.targetConfigAsync();case 2:i=e.sent,n=L(window.location.hash||(null===(a=i.skillMap)||void 0===a?void 0:a.defaultPath)),r.fetchAndParseSkillMaps(n.cmd,n.arg),t.stopPropagation(),t.preventDefault();case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.handleError=function(e){var t=e||lf("Oops! Couldn't load content, please check the URL and markdown file.");console.error(t),r.setState({error:t})},r.onStoreChange=Object(U.a)(M.a.mark((function e(){var t,a;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=se.getState(),(a=t.user)===r.loadedUser||r.loadedUser&&a.id!==r.loadedUser.id){e.next=5;break}return e.next=4,we(a);case 4:r.loadedUser=a;case 5:case"end":return e.stop()}}),e)}))),r.state={},window.addEventListener("hashchange",r.handleHashChange),r}return Object(le.a)(a,[{key:"initLocalizationAsync",value:function(){var e=Object(U.a)(M.a.mark((function e(){var t,a,r,i,n,c,s,o;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=pxt.appTarget.appTheme,a=window.location.href,r=!1,i=void 0,/[&?]translate=1/.test(a)&&!pxt.BrowserUtils.isIE()?(console.log("translation mode"),i=ts.pxtc.Util.TRANSLATION_LOCALE):((n=/(live)?(force)?lang=([a-z]{2,}(-[A-Z]+)?)/i.exec(window.location.href))&&window.location.hash.indexOf(n[0])>=0&&pxt.BrowserUtils.changeHash(window.location.hash.replace(n[0],"")),i=n?n[3]:pxt.BrowserUtils.getCookieLang()||t.defaultLocale||navigator.userLanguage||navigator.language,r=!!n&&!!n[2]),"",c=pxt.appTarget.id,s=pxt.appTarget.versions.pxtCrowdinBranch,o=pxt.appTarget.versions.targetCrowdinBranch,e.next=11,it(c,"",i,s,o,!0,r);case 11:pxt.Util.isLocaleEnabled(i)&&pxt.BrowserUtils.setCookieLang(i);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"fetchAndParseSkillMaps",value:function(){var e=Object(U.a)(M.a.mark((function e(t,a){var r,i,n,c,s,o,l,d,u,p,h,v,m=this;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_(t,a);case 2:if(r=e.sent,i=null===r||void 0===r?void 0:r.text,n=null===r||void 0===r?void 0:r.identifier,c=null===r||void 0===r?void 0:r.status,i&&n&&c)try{o=Xe(i),l=o.maps,d=o.metadata,(null===l||void 0===l?void 0:l.length)>0&&(s=l,this.props.dispatchClearSkillMaps(),l.forEach((function(e){m.props.dispatchAddSkillMap(e)}))),d&&(u=d.title,p=d.description,h=d.infoUrl,this.props.dispatchSetPageTitle(u),p&&this.props.dispatchSetPageDescription(p),h&&this.props.dispatchSetPageDescription(h)),"banned"===c?this.handleError(lf("This GitHub repository has been banned.")):(this.props.dispatchSetPageSourceUrl(n,c),this.setState({error:void 0}))}catch(f){this.handleError()}else this.setState({error:lf("No content loaded.")});return e.next=9,ke();case 9:(v=e.sent)||(v={id:G(),completedTags:{},mapProgress:{}}),n&&!v.completedTags[n]&&(v.completedTags[n]={}),this.applyQueryFlags(v,s),this.loadedUser=v,this.props.dispatchSetUser(v);case 15:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=Object(U.a)(M.a.mark((function e(){var t,a,r;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.unsubscribeChangeListener=se.subscribe(this.onStoreChange),this.queryFlags=P(),e.next=4,pxt.targetConfigAsync();case 4:return a=e.sent,r=L(window.location.hash||(null===(t=a.skillMap)||void 0===t?void 0:t.defaultPath)),e.next=8,this.initLocalizationAsync();case 8:this.fetchAndParseSkillMaps(r.cmd,r.arg);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){window.removeEventListener("hashchange",this.handleHashChange),this.unsubscribeChangeListener&&this.unsubscribeChangeListener()}},{key:"render",value:function(){var e=this.props,t=e.skillMaps,a=e.activityOpen,i=this.state.error,n=Object.keys(t).map((function(e){return t[e]}));return Object(r.jsxs)("div",{className:"app-container ".concat(pxt.appTarget.id),children:[Object(r.jsx)(Re,{}),a?Object(r.jsx)(Ee,{}):Object(r.jsxs)("div",{children:[Object(r.jsx)(Pe,{icon:"map"}),Object(r.jsx)("div",{className:"skill-map-container",children:i?Object(r.jsx)("div",{className:"skill-map-error",children:i}):null===n||void 0===n?void 0:n.map((function(e,t){return Object(r.jsx)($e,{map:e},t)}))})]}),Object(r.jsx)(Ve,{})]})}},{key:"applyQueryFlags",value:function(e,t,a){if("true"===this.queryFlags.debugNewUser&&(e.isDebug=!0,e.mapProgress={},e.completedTags={}),"true"===this.queryFlags.debugCompleted&&(e.isDebug=!0,t)){var r,i=Object(Q.a)(t);try{for(i.s();!(r=i.n()).done;){var n=r.value;e.mapProgress[n.mapId]={completionState:"completed",mapId:n.mapId,activityState:{}};for(var c=0,s=Object.keys(n.activities);c<s.length;c++){var o,l=s[c],d=n.activities[l];if(e.mapProgress[n.mapId].activityState[d.activityId]?e.mapProgress[n.mapId].activityState[d.activityId].isCompleted=!0:e.mapProgress[n.mapId].activityState[d.activityId]={activityId:d.activityId,isCompleted:!0},(null===(o=d.tags)||void 0===o?void 0:o.length)&&a){var u,p=Object(Q.a)(d.tags);try{for(p.s();!(u=p.n()).done;){var h=u.value;e.completedTags[a][h]||(e.completedTags[a][h]=0),e.completedTags[a][h]++}}catch(v){p.e(v)}finally{p.f()}}}}}catch(v){i.e(v)}finally{i.f()}}}}]),a}(n.a.Component);function it(e,t,a,r,i,n,c){return nt.apply(this,arguments)}function nt(){return(nt=Object(U.a)(M.a.mark((function e(t,a,r,i,n,c,s){var o;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("en-US"===(r=pxt.Util.normalizeLanguageCode(r)[0])&&(r="en"),r!==pxt.Util.userLanguage()&&(pxt.Util.isLocaleEnabled(r)||s)){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,pxt.Util.downloadTranslationsAsync(t,a,r,i,n,!!c,ts.pxtc.Util.TranslationsKind.SkillMap);case 6:o=e.sent,pxt.Util.setUserLanguage(r),o&&(pxt.Util.setLocalizedStrings(o),c&&(pxt.Util.localizeLive=!0));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ct={dispatchAddSkillMap:function(e){return{type:p,map:e}},dispatchClearSkillMaps:function(){return{type:h}},dispatchSetPageTitle:function(e){return{type:k,title:e}},dispatchSetPageDescription:function(e){return{type:I,description:e}},dispatchSetPageInfoUrl:function(e){return{type:w,infoUrl:e}},dispatchSetUser:function(e){return{type:O,user:e}},dispatchSetPageSourceUrl:function(e,t){return{type:S,url:e,status:t}}},st=Object(o.b)((function(e,t){return e?{skillMaps:e.maps,activityOpen:!!e.editorView}:{}}),ct)(rt),ot=window.pxtTargetBundle;ot.bundledpkgs={},pxt.setAppTarget(ot),pxt.Cloud.apiRoot="https://www.makecode.com/api/",s.a.render(Object(r.jsx)(n.a.StrictMode,{children:Object(r.jsx)(o.a,{store:se,children:Object(r.jsx)(st,{})})}),document.getElementById("root"))}},[[46,1,2]]]);
//# sourceMappingURL=main.18429d2a.chunk.js.map